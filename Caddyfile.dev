# Caddy configuration for local development
# Run with: caddy run --config Caddyfile.dev
{
	# Development mode - no HTTPS, local addresses
	auto_https off
	admin off
}

# Landing page (marketing site)
http://localhost:8080 {
	reverse_proxy localhost:3002 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
	}

	# Logging for development
	log {
		output stdout
		format json
		level INFO
	}
}

# Application frontend + API (same subdomain to avoid cookie issues)
http://app.localhost:8080 {
	# Order matters! API routes MUST be matched first

	# API documentation
	@docs path /docs /docs/*
	handle @docs {
		reverse_proxy localhost:3000 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
		}
	}

	# API routes
	@api path /api/*
	handle @api {
		reverse_proxy localhost:3000 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
		}
	}

	# All other routes go to frontend (must be last)
	handle {
		reverse_proxy localhost:3001 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
		}
	}

	# Logging for development
	log {
		output stdout
		format json
		level INFO
	}
}
